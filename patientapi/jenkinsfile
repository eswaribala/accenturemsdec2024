#!groovy
def status = false
pipeline{
 agent any
  tools {
    maven 'maven'
  }
 stages{
   stage("build"){
       steps{
          bat "mvn -f ./patientapi clean install -DskipTests"
          }
      }
   stage("dockerbuild"){
          steps{
             bat "cd patientapi & docker build -f dockerfile -t patientapiv15 ."
             }
         }
   stage("dockerhub"){
               steps{
                  bat "docker tag patientapiv15:latest eswaribala/accpatientrepo:patientapiv15"
                  bat "docker push eswaribala/accpatientrepo:patientapiv15"
                  }
              }
   stage("mysqlpv"){
                  steps{
                    script{
                     status=bat "cd patientapi & kubectl apply -f mysql-pv.yaml"
                        }
                     }
                 }
   stage("mysqldeployment"){


                          steps {
                            script{
                              if (status) {

                               bat "cd patientapi & kubectl apply -f mysql-deployment.yaml"
                                                           echo "Deployment successful"
                              }

                               }

                          }


                   }

  }
 }